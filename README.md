# TMDB Social Network

Социальная сеть для киноманов на базе Django, позволяющая пользователям регистрироваться, сохранять любимые фильмы, писать рецензии, ставить оценки и получать информацию о фильмах через TMDB API.

## Особенности

- Регистрация и аутентификация пользователей
- Добавление фильмов в список избранного
- Написание рецензий и оценка фильмов
- Просмотр рейтингов фильмов от других пользователей
- Получение данных о фильмах через TMDB API
- **Кэширование изображений постеров** для работы без VPN
- **Гибкая конфигурация окружения** для разработки и продакшена

## Технический стек

- **Backend**: Django 4.2
- **База данных**: 
  - SQLite (для разработки)
  - PostgreSQL (для продакшена)
- **Контейнеризация**: Docker и Docker Compose
- **Web-сервер**: Nginx (для продакшена)
- **Frontend**: Bootstrap 5 с Django Templates
- **API Интеграция**: TMDB API

## Требования

- Docker и Docker Compose
- Python 3.9+
- Nginx (для продакшена)

## Установка и запуск

### Локальная разработка

1. Клонировать репозиторий:
   ```bash
   git clone <repository-url>
   cd tmdb-project
   ```

2. Создать переменные окружения:
   ```bash
   cp .env.example .env
   # Отредактируйте .env файл, добавив ваш TMDB API ключ
   ```

3. Запустить скрипт разработки:
   ```bash
   chmod +x dev.sh # Только один раз, чтобы сделать скрипт исполняемым
   ./dev.sh
   ```

4. Доступ к приложению:
   - Web приложение: http://localhost:8000
   - Adminer (для управления БД): http://localhost:8080

### Развертывание на продакшене

1. Клонировать репозиторий на сервер:
   ```bash
   git clone <repository-url> /var/www/tmdb-project
   cd /var/www/tmdb-project
   ```

2. Создать переменные окружения:
   ```bash
   cp .env.example .env
   # Отредактируйте .env файл для продакшена
   ```

3. Запустить скрипт деплоя:
   ```bash
   chmod +x deploy.sh # Только один раз, чтобы сделать скрипт исполняемым
   ./deploy.sh
   ```

4. После деплоя проект будет доступен по вашему IP-адресу или домену.

## Структура проекта

```
tmdb-project/
│
├── docker-compose.yml          # Конфигурация Docker для разработки
├── docker-compose.prod.yml     # Конфигурация Docker для продакшена
├── dev.sh                      # Скрипт для запуска в режиме разработки
├── deploy.sh                   # Скрипт для деплоя на продакшен
│
├── nginx/                      # Конфигурация Nginx
│   └── tmdb-project.conf       # Настройки виртуального хоста
│
├── tmdb_net/                   # Основной пакет Django проекта
│   ├── settings.py             # Настройки Django с разделением сред
│   ├── urls.py                 # Конфигурация URL
│   └── ...
│
├── movies/                     # Приложение для работы с фильмами
│   ├── views.py                # Представления
│   ├── models.py               # Модели данных
│   ├── image_cache.py          # Кэширование изображений постеров
│   └── ...
│
├── media/                      # Загружаемые файлы (поддиректории создаются автоматически)
├── staticfiles/                # Статические файлы для продакшена (создается при деплое)
└── ...
```

## Особенности конфигурации

### Базы данных

- **Разработка**: SQLite для простоты и быстрого запуска
- **Продакшен**: PostgreSQL для надежности и производительности

Переключение происходит автоматически на основе переменных окружения:
```python
if os.environ.get('USE_SQLITE', 'False') == 'True' or DEBUG:
    # SQLite для разработки
else:
    # PostgreSQL для продакшена
```

### Обслуживание статических и медиа файлов

- **Разработка**: Django обслуживает все файлы
- **Продакшен**: Nginx обслуживает статические и медиа файлы, Django только динамический контент

### Docker Compose

- **docker-compose.yml**: Конфигурация для локальной разработки
- **docker-compose.prod.yml**: Конфигурация для продакшена

## Кэширование постеров

Система кэширования постеров позволяет:

1. Загружать изображения с TMDB только один раз
2. Хранить локальные копии для быстрого доступа
3. Предоставлять доступ к постерам даже при блокировке TMDB CDN
4. Автоматически чистить старые кэшированные файлы

Для очистки кэша вручную:
```bash
python manage.py clean_image_cache --max-age 14 --max-size 500
```

## API Интеграция

Приложение использует TMDB API для получения данных о фильмах. Необходимо получить API ключ на [TMDB](https://www.themoviedb.org/documentation/api) и установить его в `.env` файл.

## Лицензия

Этот проект распространяется под лицензией MIT - см. файл LICENSE для подробностей.
